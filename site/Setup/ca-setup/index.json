{
    "content": "<h2 id=\"certificate-authority-ca-setup\">Certificate Authority (CA) Setup</h2>\n<p>The <em>Certificate Authority</em> (CA) provides a number of certificate services to users of a blockchain. More specifically, these services relate to <em>user enrollment</em>, <em>transactions</em> invoked on the blockchain, and <em>TLS</em>-secured connections between users or components of the blockchain.</p>\n<p>This guide builds on either the <a href=\"../../dev-setup/devenv/\">fabric developer&rsquo;s setup</a> or the prerequisites articulated in the <a href=\"../Network-setup/\">fabric network setup</a> guide. If you have not already set up your environment with one of those guides, please do so before continuing.</p>\n<h3 id=\"enrollment-certificate-authority\">Enrollment Certificate Authority</h3>\n<p>The <em>enrollment certificate authority</em> (ECA) allows new users to register with the blockchain network and enables registered users to request an <em>enrollment certificate pair</em>. One certificate is for data signing, one is for data encryption. The public keys to be embedded in the certificates have to be of type ECDSA, whereby the key for data encryption is then converted by the user to be used in an <a href=\"https://en.wikipedia.org/wiki/Integrated_Encryption_Scheme\">ECIES</a> (Elliptic Curve Integrated Encryption System) fashion.</p>\n<h3 id=\"transaction-certificate-authority\">Transaction Certificate Authority</h3>\n<p>Once a user is enrolled, he or she can also request <em>transaction certificates</em> from the <em>transaction certificate authority</em> (TCA). These certificates are to be used for deploying Chaincode and for invoking Chaincode transactions on the blockchain. Although a single <em>transaction certificate</em> can be used for multiple transactions, for privacy reasons it is recommended that a new <em>transaction certificate</em> be used for each transaction.</p>\n<h3 id=\"tls-certificate-authority\">TLS Certificate Authority</h3>\n<p>In addition to <em>enrollment certificates</em> and <em>transaction certificates</em>, users will need <em>TLS certificates</em> to secure their communication channels. <em>TLS certificates</em> can be requested from the <em>TLS certificate authority</em> (TLSCA).</p>\n<h2 id=\"configuration\">Configuration</h2>\n<p>All CA services are provided by a single process, which can be configured by setting parameters in the CA configuration file <code>membersrvc.yaml</code>, which is located in the same directory as the CA binary. More specifically, the following parameters can be set:</p>\n<ul>\n<li><code>server.gomaxprocs</code>: limits the number of operating system threads used by the CA.</li>\n<li><code>server.rootpath</code>: the root path of the directory where the CA stores its state.</li>\n<li><code>server.cadir</code>: the name of the directory where the CA stores its state.</li>\n<li><code>server.port</code>: the port at which all CA services listen (multiplexing of services over the same port is provided by <a href=\"http://www.grpc.io\">GRPC</a>).</li>\n</ul>\n<p>Furthermore, logging levels can be enabled/disabled by adjusting the following settings:</p>\n<ul>\n<li><code>logging.trace</code> (off by default, useful for debugging the code only)</li>\n<li><code>logging.info</code></li>\n<li><code>logging.warning</code></li>\n<li><code>logging.error</code></li>\n<li><code>logging.panic</code></li>\n</ul>\n<p>Alternatively, these fields can be set via environment variables, which&mdash;if set&mdash;have precedence over entries in the yaml file. The corresponding environment variables are named as follows:</p>\n<pre><code>    MEMBERSRVC_CA_SERVER_GOMAXPROCS\n    MEMBERSRVC_CA_SERVER_ROOTPATH\n    MEMBERSRVC_CA_SERVER_CADIR\n    MEMBERSRVC_CA_SERVER_PORT\n</code></pre>\n\n<p>In addition, the CA may be preloaded with registered users, where each user&rsquo;s name, roles, and password are specified:</p>\n<pre><code>    eca:\n        users:\n            alice: 2 DRJ20pEql15a\n            bob: 4 7avZQLwcUe9q\n</code></pre>\n\n<p>The role value is simply a bitmask of the following:</p>\n<pre><code>    CLIENT = 1;\n    PEER = 2;\n    VALIDATOR = 4;\n    AUDITOR = 8;\n</code></pre>\n\n<p>For example, a peer that is also a validator would have a role value of 6.</p>\n<p>When the CA is started for the first time, it will generate all of its required state (e.g., internal databases, CA certificates, blockchain keys, etc.) and writes this state to the directory given in its configuration. The certificates for the CA services (i.e., for the ECA, TCA, and TLSCA) are self-signed as the current default. If those certificates shall be signed by some root CA, this can be done manually by using the <code>*.priv</code> and <code>*.pub</code> private and public keys in the CA state directory, and replacing the self-signed <code>*.cert</code> certificates with root-signed ones. The next time the CA is launched, it will read and use those root-signed certificates.</p>\n<h2 id=\"operating-the-ca\">Operating the CA</h2>\n<p>You can either <a href=\"#build-and-run\">build and run</a> the CA from source. Or, you can use Docker Compose and work with the published images on DockerHub, or some other Docker registry. Using Docker Compose is by far the simplest approach.</p>\n<h3 id=\"docker-compose\">Docker Compose</h3>\n<p>Here&rsquo;s a sample docker-compose.yml for the CA.</p>\n<pre><code>membersrvc:\n  image: hyperledger/fabric-membersrvc\n  command: membersrvc\n</code></pre>\n\n<p>The corresponding docker-compose.yml for running Docker on Mac or Windows natively looks like this:</p>\n<pre><code>membersrvc:\n  image: hyperledger/fabric-membersrvc\n  ports:\n    - &quot;7054:7054&quot;\n  command: membersrvc\n</code></pre>\n\n<p>If you are launching one or more <code>peer</code> nodes in the same docker-compose.yml, then you will want to add a delay to the start of the peer to allow sufficient time for the CA to start, before the peer attempts to connect to it.</p>\n<pre><code>membersrvc:\n  image: hyperledger/fabric-membersrvc\n  command: membersrvc\nvp0:\n  image: hyperledger/fabric-peer\n  environment:\n    - CORE_PEER_ADDRESSAUTODETECT=true\n    - CORE_VM_ENDPOINT=http://172.17.0.1:2375\n    - CORE_LOGGING_LEVEL=DEBUG\n    - CORE_PEER_ID=vp0\n    - CORE_SECURITY_ENROLLID=test_vp0\n    - CORE_SECURITY_ENROLLSECRET=MwYpmSRjupbT\n  links:\n    - membersrvc\n  command: sh -c &quot;sleep 5; peer node start&quot;\n</code></pre>\n\n<p>The corresponding docker-compose.yml for running Docker on Mac or Windows natively looks like this:</p>\n<pre><code>membersrvc:\n  image: hyperledger/fabric-membersrvc\n  ports:\n    - &quot;7054:7054&quot;\n  command: membersrvc\nvp0:\n  image: hyperledger/fabric-peer\n  ports:\n    - &quot;7050:7050&quot;\n    - &quot;7051:7051&quot;\n    - &quot;7052:7052&quot;\n  environment:\n    - CORE_PEER_ADDRESSAUTODETECT=true\n    - CORE_VM_ENDPOINT=unix:///var/run/docker.sock\n    - CORE_LOGGING_LEVEL=DEBUG\n    - CORE_PEER_ID=vp0\n    - CORE_SECURITY_ENROLLID=test_vp0\n    - CORE_SECURITY_ENROLLSECRET=MwYpmSRjupbT\n  links:\n    - membersrvc\n  command: sh -c &quot;sleep 5; peer node start&quot;\n</code></pre>\n\n<h3 id=\"build-and-run\">Build and Run</h3>\n<p>The CA can be built with the following command executed in the <code>membersrvc</code> directory:</p>\n<pre><code>cd $GOPATH/src/github.com/hyperledger/fabric\nmake membersrvc\n</code></pre>\n\n<p>The CA can be started with the following command:</p>\n<pre><code>build/bin/membersrvc\n</code></pre>\n\n<p><strong>Note:</strong> the CA must be started before any of the fabric peer nodes, to allow the CA to have initialized before any peer nodes attempt to connect to it.</p>\n<p>The CA looks for an <code>membersrvc.yaml</code> configuration file in $GOPATH/src/github.com/hyperledger/fabric/membersrvc. If the CA is started for the first time, it creates all its required state (e.g., internal databases, CA certificates, blockchain keys, etc.) and writes that state to the directory given in the CA configuration.</p>\n<!-- This needs some serious attention\n\nIf starting the peer with security/privacy enabled, environment variables for security, CA address and peer's ID and password must be included. Additionally, the fabric-membersrvc container must be started before the peer(s) are launched. Hence we will need to insert a delay in launching the peer command. Here's the docker-compose.yml for a single peer with membership services running in a **Vagrant** environment:\n\n\n\u0002wzxhzdk:9\u0003\n\n\n\n\u0002wzxhzdk:10\u0003\n\n\nAdditionally, the validating peer `enrollID` and `enrollSecret` (`vp0` and `vp0_secret`) has to be added to [membersrvc.yaml](https://github.com/hyperledger/fabric/blob/master/membersrvc/membersrvc.yaml).\n-->",
    "language": "en",
    "url": "/Setup/ca-setup/",
    "title": "CA Setup"
}